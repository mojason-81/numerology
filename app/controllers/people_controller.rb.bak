get '/people' do
	@people = Person.all
  @people = @people.sort_by{|person| person.first_name}
	erb :"/people/index"
end

get '/people/new' do
	@person = Person.new
	erb :"/people/new"
end

post '/people' do
  if params[:birthdate].include?('-')
    # Commenting out the following line allows person creation to pass, but the edit function does not work
    birthdate = Date.strptime(params[:birthdate].gsub('-', ''), "%m%d%Y")
    # Commenting out the following line allows the edit function to work, but person creation fails
    #birthdate = params[:birthdate].gsub('-', '')
  else
    birthdate = Date.strptime(params[:birthdate], "%m%d%Y")
  end

  person = Person.create(first_name: params[:first_name], last_name: params[:last_name], birthdate: birthdate)
  redirect "/people/#{person.id}"
end

get '/people/:id/edit' do
  @person = Person.find(params[:id])
  erb :'/people/edit'
end

put '/people/:id' do
  person = Person.find(params[:id])
  person.first_name = params[:first_name]
  person.last_name = params[:last_name]
  if params[:birthdate].include?('-')
    # Commenting out the following line allows person creation to pass, but the edit function does not work
    person.birthdate = Date.strptime(params[:birthdate].gsub('-', ''), "%m%d%Y")
    # Commenting out the following line allows the edit function to work, but person creation fails
    # person.birthdate = params[:birthdate].gsub('-', '')
  else
    person.birthdate = Date.strptime(params[:birthdate], "%m%d%Y")
  end
  person.save
  redirect "/people/#{person.id}"
end

get '/people/:id' do
  @person = Person.find(params[:id])
  birth_path_num = Person.get_birth_path_num(@person.birthdate.strftime("%m%d%Y"))
  @message = Person.get_message(birth_path_num)  
  erb :"/people/show"
end

delete '/people/:id' do
  Person.find(params[:id]).destroy
  redirect "/people"
end